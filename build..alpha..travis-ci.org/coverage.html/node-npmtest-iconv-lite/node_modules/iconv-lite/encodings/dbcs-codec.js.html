<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-iconv-lite/node_modules/iconv-lite/encodings/dbcs-codec.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-iconv-lite">npmtest-iconv-lite (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-iconv-lite/node_modules/iconv-lite/encodings/dbcs-codec.js</span></h1>
    <h2>
        
        Statements: <span class="metric">6.84% <small>(21 / 307)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 150)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">7.05% <small>(21 / 298)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-iconv-lite/node_modules/iconv-lite/encodings/</a> &#187; dbcs-codec.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">256</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict"
&nbsp;
// Multibyte codec. In this scheme, a character is represented by 1 or more bytes.
// Our codec supports UTF-16 surrogates, extensions for GB18030 and unicode sequences.
// To save memory and loading time, we read table files only when requested.
&nbsp;
exports._dbcs = DBCSCodec;
&nbsp;
var UNASSIGNED = -1,
    GB18030_CODE = -2,
    SEQ_START  = -10,
    NODE_START = -1000,
    UNASSIGNED_NODE = new Array(0x100),
    DEF_CHAR = -1;
&nbsp;
for (var i = 0; i &lt; 0x100; i++)
    UNASSIGNED_NODE[i] = UNASSIGNED;
&nbsp;
&nbsp;
// Class DBCSCodec reads and initializes mapping tables.
<span class="fstat-no" title="function not covered" >function DBCSCodec(codecOptions, iconv) {</span>
<span class="cstat-no" title="statement not covered" >    this.encodingName = codecOptions.encodingName;</span>
<span class="cstat-no" title="statement not covered" >    if (!codecOptions)</span>
<span class="cstat-no" title="statement not covered" >        throw new Error("DBCS codec is called without the data.")</span>
<span class="cstat-no" title="statement not covered" >    if (!codecOptions.table)</span>
<span class="cstat-no" title="statement not covered" >        throw new Error("Encoding '" + this.encodingName + "' has no data.");</span>
&nbsp;
    // Load tables.
<span class="cstat-no" title="statement not covered" >    var mappingTable = codecOptions.table();</span>
&nbsp;
&nbsp;
    // Decode tables: MBCS -&gt; Unicode.
&nbsp;
    // decodeTables is a trie, encoded as an array of arrays of integers. Internal arrays are trie nodes and all have len = 256.
    // Trie root is decodeTables[0].
    // Values: &gt;=  0 -&gt; unicode character code. can be &gt; 0xFFFF
    //         == UNASSIGNED -&gt; unknown/unassigned sequence.
    //         == GB18030_CODE -&gt; this is the end of a GB18030 4-byte sequence.
    //         &lt;= NODE_START -&gt; index of the next node in our trie to process next byte.
    //         &lt;= SEQ_START  -&gt; index of the start of a character code sequence, in decodeTableSeq.
<span class="cstat-no" title="statement not covered" >    this.decodeTables = [];</span>
<span class="cstat-no" title="statement not covered" >    this.decodeTables[0] = UNASSIGNED_NODE.slice(0); </span>// Create root node.
&nbsp;
    // Sometimes a MBCS char corresponds to a sequence of unicode chars. We store them as arrays of integers here. 
<span class="cstat-no" title="statement not covered" >    this.decodeTableSeq = [];</span>
&nbsp;
    // Actual mapping tables consist of chunks. Use them to fill up decode tables.
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; mappingTable.length; i++)</span>
<span class="cstat-no" title="statement not covered" >        this._addDecodeChunk(mappingTable[i]);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.defaultCharUnicode = iconv.defaultCharUnicode;</span>
&nbsp;
    
    // Encode tables: Unicode -&gt; DBCS.
&nbsp;
    // `encodeTable` is array mapping from unicode char to encoded char. All its values are integers for performance.
    // Because it can be sparse, it is represented as array of buckets by 256 chars each. Bucket can be null.
    // Values: &gt;=  0 -&gt; it is a normal char. Write the value (if &lt;=256 then 1 byte, if &lt;=65536 then 2 bytes, etc.).
    //         == UNASSIGNED -&gt; no conversion found. Output a default char.
    //         &lt;= SEQ_START  -&gt; it's an index in encodeTableSeq, see below. The character starts a sequence.
<span class="cstat-no" title="statement not covered" >    this.encodeTable = [];</span>
    
    // `encodeTableSeq` is used when a sequence of unicode characters is encoded as a single code. We use a tree of
    // objects where keys correspond to characters in sequence and leafs are the encoded dbcs values. A special DEF_CHAR key
    // means end of sequence (needed when one sequence is a strict subsequence of another).
    // Objects are kept separately from encodeTable to increase performance.
<span class="cstat-no" title="statement not covered" >    this.encodeTableSeq = [];</span>
&nbsp;
    // Some chars can be decoded, but need not be encoded.
<span class="cstat-no" title="statement not covered" >    var skipEncodeChars = {};</span>
<span class="cstat-no" title="statement not covered" >    if (codecOptions.encodeSkipVals)</span>
<span class="cstat-no" title="statement not covered" >        for (var i = 0; i &lt; codecOptions.encodeSkipVals.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >            var val = codecOptions.encodeSkipVals[i];</span>
<span class="cstat-no" title="statement not covered" >            if (typeof val === 'number')</span>
<span class="cstat-no" title="statement not covered" >                skipEncodeChars[val] = true;</span>
            else
<span class="cstat-no" title="statement not covered" >                for (var j = val.from; j &lt;= val.to; j++)</span>
<span class="cstat-no" title="statement not covered" >                    skipEncodeChars[j] = true;</span>
        }
        
    // Use decode trie to recursively fill out encode tables.
<span class="cstat-no" title="statement not covered" >    this._fillEncodeTable(0, 0, skipEncodeChars);</span>
&nbsp;
    // Add more encoding pairs when needed.
<span class="cstat-no" title="statement not covered" >    if (codecOptions.encodeAdd) {</span>
<span class="cstat-no" title="statement not covered" >        for (var uChar in codecOptions.encodeAdd)</span>
<span class="cstat-no" title="statement not covered" >            if (Object.prototype.hasOwnProperty.call(codecOptions.encodeAdd, uChar))</span>
<span class="cstat-no" title="statement not covered" >                this._setEncodeChar(uChar.charCodeAt(0), codecOptions.encodeAdd[uChar]);</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.defCharSB  = this.encodeTable[0][iconv.defaultCharSingleByte.charCodeAt(0)];</span>
<span class="cstat-no" title="statement not covered" >    if (this.defCharSB === UNASSIGNED) <span class="cstat-no" title="statement not covered" >this.defCharSB = this.encodeTable[0]['?'];</span></span>
<span class="cstat-no" title="statement not covered" >    if (this.defCharSB === UNASSIGNED) <span class="cstat-no" title="statement not covered" >this.defCharSB = "?".charCodeAt(0);</span></span>
&nbsp;
&nbsp;
    // Load &amp; create GB18030 tables when needed.
<span class="cstat-no" title="statement not covered" >    if (typeof codecOptions.gb18030 === 'function') {</span>
<span class="cstat-no" title="statement not covered" >        this.gb18030 = codecOptions.gb18030(); </span>// Load GB18030 ranges.
&nbsp;
        // Add GB18030 decode tables.
<span class="cstat-no" title="statement not covered" >        var thirdByteNodeIdx = this.decodeTables.length;</span>
<span class="cstat-no" title="statement not covered" >        var thirdByteNode = this.decodeTables[thirdByteNodeIdx] = UNASSIGNED_NODE.slice(0);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        var fourthByteNodeIdx = this.decodeTables.length;</span>
<span class="cstat-no" title="statement not covered" >        var fourthByteNode = this.decodeTables[fourthByteNodeIdx] = UNASSIGNED_NODE.slice(0);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        for (var i = 0x81; i &lt;= 0xFE; i++) {</span>
<span class="cstat-no" title="statement not covered" >            var secondByteNodeIdx = NODE_START - this.decodeTables[0][i];</span>
<span class="cstat-no" title="statement not covered" >            var secondByteNode = this.decodeTables[secondByteNodeIdx];</span>
<span class="cstat-no" title="statement not covered" >            for (var j = 0x30; j &lt;= 0x39; j++)</span>
<span class="cstat-no" title="statement not covered" >                secondByteNode[j] = NODE_START - thirdByteNodeIdx;</span>
        }
<span class="cstat-no" title="statement not covered" >        for (var i = 0x81; i &lt;= 0xFE; i++)</span>
<span class="cstat-no" title="statement not covered" >            thirdByteNode[i] = NODE_START - fourthByteNodeIdx;</span>
<span class="cstat-no" title="statement not covered" >        for (var i = 0x30; i &lt;= 0x39; i++)</span>
<span class="cstat-no" title="statement not covered" >            fourthByteNode[i] = GB18030_CODE</span>
    }        
}
&nbsp;
DBCSCodec.prototype.encoder = DBCSEncoder;
DBCSCodec.prototype.decoder = DBCSDecoder;
&nbsp;
// Decoder helpers
DBCSCodec.prototype._getDecodeTrieNode = <span class="fstat-no" title="function not covered" >function(addr) {</span>
<span class="cstat-no" title="statement not covered" >    var bytes = [];</span>
<span class="cstat-no" title="statement not covered" >    for (; addr &gt; 0; addr &gt;&gt;= 8)</span>
<span class="cstat-no" title="statement not covered" >        bytes.push(addr &amp; 0xFF);</span>
<span class="cstat-no" title="statement not covered" >    if (bytes.length == 0)</span>
<span class="cstat-no" title="statement not covered" >        bytes.push(0);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var node = this.decodeTables[0];</span>
<span class="cstat-no" title="statement not covered" >    for (var i = bytes.length-1; i &gt; 0; i--) { // Traverse nodes deeper into the trie.</span>
<span class="cstat-no" title="statement not covered" >        var val = node[bytes[i]];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (val == UNASSIGNED) { // Create new node.</span>
<span class="cstat-no" title="statement not covered" >            node[bytes[i]] = NODE_START - this.decodeTables.length;</span>
<span class="cstat-no" title="statement not covered" >            this.decodeTables.push(node = UNASSIGNED_NODE.slice(0));</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (val &lt;= NODE_START) { // Existing node.</span>
<span class="cstat-no" title="statement not covered" >            node = this.decodeTables[NODE_START - val];</span>
        }
        else
<span class="cstat-no" title="statement not covered" >            throw new Error("Overwrite byte in " + this.encodingName + ", addr: " + addr.toString(16));</span>
    }
<span class="cstat-no" title="statement not covered" >    return node;</span>
}
&nbsp;
&nbsp;
DBCSCodec.prototype._addDecodeChunk = <span class="fstat-no" title="function not covered" >function(chunk) {</span>
    // First element of chunk is the hex mbcs code where we start.
<span class="cstat-no" title="statement not covered" >    var curAddr = parseInt(chunk[0], 16);</span>
&nbsp;
    // Choose the decoding node where we'll write our chars.
<span class="cstat-no" title="statement not covered" >    var writeTable = this._getDecodeTrieNode(curAddr);</span>
<span class="cstat-no" title="statement not covered" >    curAddr = curAddr &amp; 0xFF;</span>
&nbsp;
    // Write all other elements of the chunk to the table.
<span class="cstat-no" title="statement not covered" >    for (var k = 1; k &lt; chunk.length; k++) {</span>
<span class="cstat-no" title="statement not covered" >        var part = chunk[k];</span>
<span class="cstat-no" title="statement not covered" >        if (typeof part === "string") { // String, write as-is.</span>
<span class="cstat-no" title="statement not covered" >            for (var l = 0; l &lt; part.length;) {</span>
<span class="cstat-no" title="statement not covered" >                var code = part.charCodeAt(l++);</span>
<span class="cstat-no" title="statement not covered" >                if (0xD800 &lt;= code &amp;&amp; code &lt; 0xDC00) { // Decode surrogate</span>
<span class="cstat-no" title="statement not covered" >                    var codeTrail = part.charCodeAt(l++);</span>
<span class="cstat-no" title="statement not covered" >                    if (0xDC00 &lt;= codeTrail &amp;&amp; codeTrail &lt; 0xE000)</span>
<span class="cstat-no" title="statement not covered" >                        writeTable[curAddr++] = 0x10000 + (code - 0xD800) * 0x400 + (codeTrail - 0xDC00);</span>
                    else
<span class="cstat-no" title="statement not covered" >                        throw new Error("Incorrect surrogate pair in "  + this.encodingName + " at chunk " + chunk[0]);</span>
                }
                else <span class="cstat-no" title="statement not covered" >if (0x0FF0 &lt; code &amp;&amp; code &lt;= 0x0FFF) { // Character sequence (our own encoding used)</span>
<span class="cstat-no" title="statement not covered" >                    var len = 0xFFF - code + 2;</span>
<span class="cstat-no" title="statement not covered" >                    var seq = [];</span>
<span class="cstat-no" title="statement not covered" >                    for (var m = 0; m &lt; len; m++)</span>
<span class="cstat-no" title="statement not covered" >                        seq.push(part.charCodeAt(l++)); </span>// Simple variation: don't support surrogates or subsequences in seq.
&nbsp;
<span class="cstat-no" title="statement not covered" >                    writeTable[curAddr++] = SEQ_START - this.decodeTableSeq.length;</span>
<span class="cstat-no" title="statement not covered" >                    this.decodeTableSeq.push(seq);</span>
                }
                else
<span class="cstat-no" title="statement not covered" >                    writeTable[curAddr++] = code; </span>// Basic char
            }
        } 
        else <span class="cstat-no" title="statement not covered" >if (typeof part === "number") { // Integer, meaning increasing sequence starting with prev character.</span>
<span class="cstat-no" title="statement not covered" >            var charCode = writeTable[curAddr - 1] + 1;</span>
<span class="cstat-no" title="statement not covered" >            for (var l = 0; l &lt; part; l++)</span>
<span class="cstat-no" title="statement not covered" >                writeTable[curAddr++] = charCode++;</span>
        }
        else
<span class="cstat-no" title="statement not covered" >            throw new Error("Incorrect type '" + typeof part + "' given in "  + this.encodingName + " at chunk " + chunk[0]);</span>
    }
<span class="cstat-no" title="statement not covered" >    if (curAddr &gt; 0xFF)</span>
<span class="cstat-no" title="statement not covered" >        throw new Error("Incorrect chunk in "  + this.encodingName + " at addr " + chunk[0] + ": too long" + curAddr);</span>
}
&nbsp;
// Encoder helpers
DBCSCodec.prototype._getEncodeBucket = <span class="fstat-no" title="function not covered" >function(uCode) {</span>
<span class="cstat-no" title="statement not covered" >    var high = uCode &gt;&gt; 8; </span>// This could be &gt; 0xFF because of astral characters.
<span class="cstat-no" title="statement not covered" >    if (this.encodeTable[high] === undefined)</span>
<span class="cstat-no" title="statement not covered" >        this.encodeTable[high] = UNASSIGNED_NODE.slice(0); </span>// Create bucket on demand.
<span class="cstat-no" title="statement not covered" >    return this.encodeTable[high];</span>
}
&nbsp;
DBCSCodec.prototype._setEncodeChar = <span class="fstat-no" title="function not covered" >function(uCode, dbcsCode) {</span>
<span class="cstat-no" title="statement not covered" >    var bucket = this._getEncodeBucket(uCode);</span>
<span class="cstat-no" title="statement not covered" >    var low = uCode &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >    if (bucket[low] &lt;= SEQ_START)</span>
<span class="cstat-no" title="statement not covered" >        this.encodeTableSeq[SEQ_START-bucket[low]][DEF_CHAR] = dbcsCode; </span>// There's already a sequence, set a single-char subsequence of it.
    else <span class="cstat-no" title="statement not covered" >if (bucket[low] == UNASSIGNED)</span>
<span class="cstat-no" title="statement not covered" >        bucket[low] = dbcsCode;</span>
}
&nbsp;
DBCSCodec.prototype._setEncodeSequence = <span class="fstat-no" title="function not covered" >function(seq, dbcsCode) {</span>
    
    // Get the root of character tree according to first character of the sequence.
<span class="cstat-no" title="statement not covered" >    var uCode = seq[0];</span>
<span class="cstat-no" title="statement not covered" >    var bucket = this._getEncodeBucket(uCode);</span>
<span class="cstat-no" title="statement not covered" >    var low = uCode &amp; 0xFF;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var node;</span>
<span class="cstat-no" title="statement not covered" >    if (bucket[low] &lt;= SEQ_START) {</span>
        // There's already a sequence with  - use it.
<span class="cstat-no" title="statement not covered" >        node = this.encodeTableSeq[SEQ_START-bucket[low]];</span>
    }
    else {
        // There was no sequence object - allocate a new one.
<span class="cstat-no" title="statement not covered" >        node = {};</span>
<span class="cstat-no" title="statement not covered" >        if (bucket[low] !== UNASSIGNED) <span class="cstat-no" title="statement not covered" >node[DEF_CHAR] = bucket[low]; </span></span>// If a char was set before - make it a single-char subsequence.
<span class="cstat-no" title="statement not covered" >        bucket[low] = SEQ_START - this.encodeTableSeq.length;</span>
<span class="cstat-no" title="statement not covered" >        this.encodeTableSeq.push(node);</span>
    }
&nbsp;
    // Traverse the character tree, allocating new nodes as needed.
<span class="cstat-no" title="statement not covered" >    for (var j = 1; j &lt; seq.length-1; j++) {</span>
<span class="cstat-no" title="statement not covered" >        var oldVal = node[uCode];</span>
<span class="cstat-no" title="statement not covered" >        if (typeof oldVal === 'object')</span>
<span class="cstat-no" title="statement not covered" >            node = oldVal;</span>
        else {
<span class="cstat-no" title="statement not covered" >            node = node[uCode] = {}</span>
<span class="cstat-no" title="statement not covered" >            if (oldVal !== undefined)</span>
<span class="cstat-no" title="statement not covered" >                node[DEF_CHAR] = oldVal</span>
        }
    }
&nbsp;
    // Set the leaf to given dbcsCode.
<span class="cstat-no" title="statement not covered" >    uCode = seq[seq.length-1];</span>
<span class="cstat-no" title="statement not covered" >    node[uCode] = dbcsCode;</span>
}
&nbsp;
DBCSCodec.prototype._fillEncodeTable = <span class="fstat-no" title="function not covered" >function(nodeIdx, prefix, skipEncodeChars) {</span>
<span class="cstat-no" title="statement not covered" >    var node = this.decodeTables[nodeIdx];</span>
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; 0x100; i++) {</span>
<span class="cstat-no" title="statement not covered" >        var uCode = node[i];</span>
<span class="cstat-no" title="statement not covered" >        var mbCode = prefix + i;</span>
<span class="cstat-no" title="statement not covered" >        if (skipEncodeChars[mbCode])</span>
<span class="cstat-no" title="statement not covered" >            continue;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (uCode &gt;= 0)</span>
<span class="cstat-no" title="statement not covered" >            this._setEncodeChar(uCode, mbCode);</span>
        else <span class="cstat-no" title="statement not covered" >if (uCode &lt;= NODE_START)</span>
<span class="cstat-no" title="statement not covered" >            this._fillEncodeTable(NODE_START - uCode, mbCode &lt;&lt; 8, skipEncodeChars);</span>
        else <span class="cstat-no" title="statement not covered" >if (uCode &lt;= SEQ_START)</span>
<span class="cstat-no" title="statement not covered" >            this._setEncodeSequence(this.decodeTableSeq[SEQ_START - uCode], mbCode);</span>
    }
}
&nbsp;
&nbsp;
&nbsp;
// == Encoder ==================================================================
&nbsp;
<span class="fstat-no" title="function not covered" >function DBCSEncoder(options, codec) {</span>
    // Encoder state
<span class="cstat-no" title="statement not covered" >    this.leadSurrogate = -1;</span>
<span class="cstat-no" title="statement not covered" >    this.seqObj = undefined;</span>
    
    // Static data
<span class="cstat-no" title="statement not covered" >    this.encodeTable = codec.encodeTable;</span>
<span class="cstat-no" title="statement not covered" >    this.encodeTableSeq = codec.encodeTableSeq;</span>
<span class="cstat-no" title="statement not covered" >    this.defaultCharSingleByte = codec.defCharSB;</span>
<span class="cstat-no" title="statement not covered" >    this.gb18030 = codec.gb18030;</span>
}
&nbsp;
DBCSEncoder.prototype.write = <span class="fstat-no" title="function not covered" >function(str) {</span>
<span class="cstat-no" title="statement not covered" >    var newBuf = new Buffer(str.length * (this.gb18030 ? 4 : 3)), </span>
        leadSurrogate = this.leadSurrogate,
        seqObj = this.seqObj, nextChar = -1,
        i = 0, j = 0;
&nbsp;
<span class="cstat-no" title="statement not covered" >    while (true) {</span>
        // 0. Get next character.
<span class="cstat-no" title="statement not covered" >        if (nextChar === -1) {</span>
<span class="cstat-no" title="statement not covered" >            if (i == str.length) <span class="cstat-no" title="statement not covered" >break;</span></span>
<span class="cstat-no" title="statement not covered" >            var uCode = str.charCodeAt(i++);</span>
        }
        else {
<span class="cstat-no" title="statement not covered" >            var uCode = nextChar;</span>
<span class="cstat-no" title="statement not covered" >            nextChar = -1;    </span>
        }
&nbsp;
        // 1. Handle surrogates.
<span class="cstat-no" title="statement not covered" >        if (0xD800 &lt;= uCode &amp;&amp; uCode &lt; 0xE000) { // Char is one of surrogates.</span>
<span class="cstat-no" title="statement not covered" >            if (uCode &lt; 0xDC00) { // We've got lead surrogate.</span>
<span class="cstat-no" title="statement not covered" >                if (leadSurrogate === -1) {</span>
<span class="cstat-no" title="statement not covered" >                    leadSurrogate = uCode;</span>
<span class="cstat-no" title="statement not covered" >                    continue;</span>
                } else {
<span class="cstat-no" title="statement not covered" >                    leadSurrogate = uCode;</span>
                    // Double lead surrogate found.
<span class="cstat-no" title="statement not covered" >                    uCode = UNASSIGNED;</span>
                }
            } else { // We've got trail surrogate.
<span class="cstat-no" title="statement not covered" >                if (leadSurrogate !== -1) {</span>
<span class="cstat-no" title="statement not covered" >                    uCode = 0x10000 + (leadSurrogate - 0xD800) * 0x400 + (uCode - 0xDC00);</span>
<span class="cstat-no" title="statement not covered" >                    leadSurrogate = -1;</span>
                } else {
                    // Incomplete surrogate pair - only trail surrogate found.
<span class="cstat-no" title="statement not covered" >                    uCode = UNASSIGNED;</span>
                }
                
            }
        }
        else <span class="cstat-no" title="statement not covered" >if (leadSurrogate !== -1) {</span>
            // Incomplete surrogate pair - only lead surrogate found.
<span class="cstat-no" title="statement not covered" >            nextChar = uCode; <span class="cstat-no" title="statement not covered" ></span>uCode = UNASSIGNED; </span>// Write an error, then current char.
<span class="cstat-no" title="statement not covered" >            leadSurrogate = -1;</span>
        }
&nbsp;
        // 2. Convert uCode character.
<span class="cstat-no" title="statement not covered" >        var dbcsCode = UNASSIGNED;</span>
<span class="cstat-no" title="statement not covered" >        if (seqObj !== undefined &amp;&amp; uCode != UNASSIGNED) { // We are in the middle of the sequence</span>
<span class="cstat-no" title="statement not covered" >            var resCode = seqObj[uCode];</span>
<span class="cstat-no" title="statement not covered" >            if (typeof resCode === 'object') { // Sequence continues.</span>
<span class="cstat-no" title="statement not covered" >                seqObj = resCode;</span>
<span class="cstat-no" title="statement not covered" >                continue;</span>
&nbsp;
            } else <span class="cstat-no" title="statement not covered" >if (typeof resCode == 'number') { // Sequence finished. Write it.</span>
<span class="cstat-no" title="statement not covered" >                dbcsCode = resCode;</span>
&nbsp;
            } else <span class="cstat-no" title="statement not covered" >if (resCode == undefined) { // Current character is not part of the sequence.</span>
&nbsp;
                // Try default character for this sequence
<span class="cstat-no" title="statement not covered" >                resCode = seqObj[DEF_CHAR];</span>
<span class="cstat-no" title="statement not covered" >                if (resCode !== undefined) {</span>
<span class="cstat-no" title="statement not covered" >                    dbcsCode = resCode; </span>// Found. Write it.
<span class="cstat-no" title="statement not covered" >                    nextChar = uCode; </span>// Current character will be written too in the next iteration.
&nbsp;
                } else {
                    // TODO: What if we have no default? (resCode == undefined)
                    // Then, we should write first char of the sequence as-is and try the rest recursively.
                    // Didn't do it for now because no encoding has this situation yet.
                    // Currently, just skip the sequence and write current char.
                }
            }
<span class="cstat-no" title="statement not covered" >            seqObj = undefined;</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (uCode &gt;= 0) {  // Regular character</span>
<span class="cstat-no" title="statement not covered" >            var subtable = this.encodeTable[uCode &gt;&gt; 8];</span>
<span class="cstat-no" title="statement not covered" >            if (subtable !== undefined)</span>
<span class="cstat-no" title="statement not covered" >                dbcsCode = subtable[uCode &amp; 0xFF];</span>
            
<span class="cstat-no" title="statement not covered" >            if (dbcsCode &lt;= SEQ_START) { // Sequence start</span>
<span class="cstat-no" title="statement not covered" >                seqObj = this.encodeTableSeq[SEQ_START-dbcsCode];</span>
<span class="cstat-no" title="statement not covered" >                continue;</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (dbcsCode == UNASSIGNED &amp;&amp; this.gb18030) {</span>
                // Use GB18030 algorithm to find character(s) to write.
<span class="cstat-no" title="statement not covered" >                var idx = findIdx(this.gb18030.uChars, uCode);</span>
<span class="cstat-no" title="statement not covered" >                if (idx != -1) {</span>
<span class="cstat-no" title="statement not covered" >                    var dbcsCode = this.gb18030.gbChars[idx] + (uCode - this.gb18030.uChars[idx]);</span>
<span class="cstat-no" title="statement not covered" >                    newBuf[j++] = 0x81 + Math.floor(dbcsCode / 12600); <span class="cstat-no" title="statement not covered" ></span>dbcsCode = dbcsCode % 12600;</span>
<span class="cstat-no" title="statement not covered" >                    newBuf[j++] = 0x30 + Math.floor(dbcsCode / 1260); <span class="cstat-no" title="statement not covered" ></span>dbcsCode = dbcsCode % 1260;</span>
<span class="cstat-no" title="statement not covered" >                    newBuf[j++] = 0x81 + Math.floor(dbcsCode / 10); <span class="cstat-no" title="statement not covered" ></span>dbcsCode = dbcsCode % 10;</span>
<span class="cstat-no" title="statement not covered" >                    newBuf[j++] = 0x30 + dbcsCode;</span>
<span class="cstat-no" title="statement not covered" >                    continue;</span>
                }
            }
        }
&nbsp;
        // 3. Write dbcsCode character.
<span class="cstat-no" title="statement not covered" >        if (dbcsCode === UNASSIGNED)</span>
<span class="cstat-no" title="statement not covered" >            dbcsCode = this.defaultCharSingleByte;</span>
        
<span class="cstat-no" title="statement not covered" >        if (dbcsCode &lt; 0x100) {</span>
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = dbcsCode;</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (dbcsCode &lt; 0x10000) {</span>
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = dbcsCode &gt;&gt; 8; </span>  // high byte
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = dbcsCode &amp; 0xFF; </span>// low byte
        }
        else {
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = dbcsCode &gt;&gt; 16;</span>
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = (dbcsCode &gt;&gt; 8) &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = dbcsCode &amp; 0xFF;</span>
        }
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.seqObj = seqObj;</span>
<span class="cstat-no" title="statement not covered" >    this.leadSurrogate = leadSurrogate;</span>
<span class="cstat-no" title="statement not covered" >    return newBuf.slice(0, j);</span>
}
&nbsp;
DBCSEncoder.prototype.end = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >    if (this.leadSurrogate === -1 &amp;&amp; this.seqObj === undefined)</span>
<span class="cstat-no" title="statement not covered" >        return; </span>// All clean. Most often case.
&nbsp;
<span class="cstat-no" title="statement not covered" >    var newBuf = new Buffer(10), j = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (this.seqObj) { // We're in the sequence.</span>
<span class="cstat-no" title="statement not covered" >        var dbcsCode = this.seqObj[DEF_CHAR];</span>
<span class="cstat-no" title="statement not covered" >        if (dbcsCode !== undefined) { // Write beginning of the sequence.</span>
<span class="cstat-no" title="statement not covered" >            if (dbcsCode &lt; 0x100) {</span>
<span class="cstat-no" title="statement not covered" >                newBuf[j++] = dbcsCode;</span>
            }
            else {
<span class="cstat-no" title="statement not covered" >                newBuf[j++] = dbcsCode &gt;&gt; 8; </span>  // high byte
<span class="cstat-no" title="statement not covered" >                newBuf[j++] = dbcsCode &amp; 0xFF; </span>// low byte
            }
        } else {
            // See todo above.
        }
<span class="cstat-no" title="statement not covered" >        this.seqObj = undefined;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (this.leadSurrogate !== -1) {</span>
        // Incomplete surrogate pair - only lead surrogate found.
<span class="cstat-no" title="statement not covered" >        newBuf[j++] = this.defaultCharSingleByte;</span>
<span class="cstat-no" title="statement not covered" >        this.leadSurrogate = -1;</span>
    }
    
<span class="cstat-no" title="statement not covered" >    return newBuf.slice(0, j);</span>
}
&nbsp;
// Export for testing
DBCSEncoder.prototype.findIdx = findIdx;
&nbsp;
&nbsp;
// == Decoder ==================================================================
&nbsp;
<span class="fstat-no" title="function not covered" >function DBCSDecoder(options, codec) {</span>
    // Decoder state
<span class="cstat-no" title="statement not covered" >    this.nodeIdx = 0;</span>
<span class="cstat-no" title="statement not covered" >    this.prevBuf = new Buffer(0);</span>
&nbsp;
    // Static data
<span class="cstat-no" title="statement not covered" >    this.decodeTables = codec.decodeTables;</span>
<span class="cstat-no" title="statement not covered" >    this.decodeTableSeq = codec.decodeTableSeq;</span>
<span class="cstat-no" title="statement not covered" >    this.defaultCharUnicode = codec.defaultCharUnicode;</span>
<span class="cstat-no" title="statement not covered" >    this.gb18030 = codec.gb18030;</span>
}
&nbsp;
DBCSDecoder.prototype.write = <span class="fstat-no" title="function not covered" >function(buf) {</span>
<span class="cstat-no" title="statement not covered" >    var newBuf = new Buffer(buf.length*2),</span>
        nodeIdx = this.nodeIdx, 
        prevBuf = this.prevBuf, prevBufOffset = this.prevBuf.length,
        seqStart = -this.prevBuf.length, // idx of the start of current parsed sequence.
        uCode;
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (prevBufOffset &gt; 0) // Make prev buf overlap a little to make it easier to slice later.</span>
<span class="cstat-no" title="statement not covered" >        prevBuf = Buffer.concat([prevBuf, buf.slice(0, 10)]);</span>
    
<span class="cstat-no" title="statement not covered" >    for (var i = 0, j = 0; i &lt; buf.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >        var curByte = (i &gt;= 0) ? buf[i] : prevBuf[i + prevBufOffset];</span>
&nbsp;
        // Lookup in current trie node.
<span class="cstat-no" title="statement not covered" >        var uCode = this.decodeTables[nodeIdx][curByte];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (uCode &gt;= 0) { </span>
            // Normal character, just use it.
        }
        else <span class="cstat-no" title="statement not covered" >if (uCode === UNASSIGNED) { // Unknown char.</span>
            // TODO: Callback with seq.
            //var curSeq = (seqStart &gt;= 0) ? buf.slice(seqStart, i+1) : prevBuf.slice(seqStart + prevBufOffset, i+1 + prevBufOffset);
<span class="cstat-no" title="statement not covered" >            i = seqStart; </span>// Try to parse again, after skipping first byte of the sequence ('i' will be incremented by 'for' cycle).
<span class="cstat-no" title="statement not covered" >            uCode = this.defaultCharUnicode.charCodeAt(0);</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (uCode === GB18030_CODE) {</span>
<span class="cstat-no" title="statement not covered" >            var curSeq = (seqStart &gt;= 0) ? buf.slice(seqStart, i+1) : prevBuf.slice(seqStart + prevBufOffset, i+1 + prevBufOffset);</span>
<span class="cstat-no" title="statement not covered" >            var ptr = (curSeq[0]-0x81)*12600 + (curSeq[1]-0x30)*1260 + (curSeq[2]-0x81)*10 + (curSeq[3]-0x30);</span>
<span class="cstat-no" title="statement not covered" >            var idx = findIdx(this.gb18030.gbChars, ptr);</span>
<span class="cstat-no" title="statement not covered" >            uCode = this.gb18030.uChars[idx] + ptr - this.gb18030.gbChars[idx];</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (uCode &lt;= NODE_START) { // Go to next trie node.</span>
<span class="cstat-no" title="statement not covered" >            nodeIdx = NODE_START - uCode;</span>
<span class="cstat-no" title="statement not covered" >            continue;</span>
        }
        else <span class="cstat-no" title="statement not covered" >if (uCode &lt;= SEQ_START) { // Output a sequence of chars.</span>
<span class="cstat-no" title="statement not covered" >            var seq = this.decodeTableSeq[SEQ_START - uCode];</span>
<span class="cstat-no" title="statement not covered" >            for (var k = 0; k &lt; seq.length - 1; k++) {</span>
<span class="cstat-no" title="statement not covered" >                uCode = seq[k];</span>
<span class="cstat-no" title="statement not covered" >                newBuf[j++] = uCode &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >                newBuf[j++] = uCode &gt;&gt; 8;</span>
            }
<span class="cstat-no" title="statement not covered" >            uCode = seq[seq.length-1];</span>
        }
        else
<span class="cstat-no" title="statement not covered" >            throw new Error("iconv-lite internal error: invalid decoding table value " + uCode + " at " + nodeIdx + "/" + curByte);</span>
&nbsp;
        // Write the character to buffer, handling higher planes using surrogate pair.
<span class="cstat-no" title="statement not covered" >        if (uCode &gt; 0xFFFF) { </span>
<span class="cstat-no" title="statement not covered" >            uCode -= 0x10000;</span>
<span class="cstat-no" title="statement not covered" >            var uCodeLead = 0xD800 + Math.floor(uCode / 0x400);</span>
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = uCodeLead &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >            newBuf[j++] = uCodeLead &gt;&gt; 8;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            uCode = 0xDC00 + uCode % 0x400;</span>
        }
<span class="cstat-no" title="statement not covered" >        newBuf[j++] = uCode &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >        newBuf[j++] = uCode &gt;&gt; 8;</span>
&nbsp;
        // Reset trie node.
<span class="cstat-no" title="statement not covered" >        nodeIdx = 0; <span class="cstat-no" title="statement not covered" ></span>seqStart = i+1;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.nodeIdx = nodeIdx;</span>
<span class="cstat-no" title="statement not covered" >    this.prevBuf = (seqStart &gt;= 0) ? buf.slice(seqStart) : prevBuf.slice(seqStart + prevBufOffset);</span>
<span class="cstat-no" title="statement not covered" >    return newBuf.slice(0, j).toString('ucs2');</span>
}
&nbsp;
DBCSDecoder.prototype.end = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >    var ret = '';</span>
&nbsp;
    // Try to parse all remaining chars.
<span class="cstat-no" title="statement not covered" >    while (this.prevBuf.length &gt; 0) {</span>
        // Skip 1 character in the buffer.
<span class="cstat-no" title="statement not covered" >        ret += this.defaultCharUnicode;</span>
<span class="cstat-no" title="statement not covered" >        var buf = this.prevBuf.slice(1);</span>
&nbsp;
        // Parse remaining as usual.
<span class="cstat-no" title="statement not covered" >        this.prevBuf = new Buffer(0);</span>
<span class="cstat-no" title="statement not covered" >        this.nodeIdx = 0;</span>
<span class="cstat-no" title="statement not covered" >        if (buf.length &gt; 0)</span>
<span class="cstat-no" title="statement not covered" >            ret += this.write(buf);</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.nodeIdx = 0;</span>
<span class="cstat-no" title="statement not covered" >    return ret;</span>
}
&nbsp;
// Binary search for GB18030. Returns largest i such that table[i] &lt;= val.
<span class="fstat-no" title="function not covered" >function findIdx(table, val) {</span>
<span class="cstat-no" title="statement not covered" >    if (table[0] &gt; val)</span>
<span class="cstat-no" title="statement not covered" >        return -1;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var l = 0, r = table.length;</span>
<span class="cstat-no" title="statement not covered" >    while (l &lt; r-1) { // always table[l] &lt;= val &lt; table[r]</span>
<span class="cstat-no" title="statement not covered" >        var mid = l + Math.floor((r-l+1)/2);</span>
<span class="cstat-no" title="statement not covered" >        if (table[mid] &lt;= val)</span>
<span class="cstat-no" title="statement not covered" >            l = mid;</span>
        else
<span class="cstat-no" title="statement not covered" >            r = mid;</span>
    }
<span class="cstat-no" title="statement not covered" >    return l;</span>
}
&nbsp;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Mon Apr 17 2017 16:42:05 GMT+0000 (UTC)</div>
</div>
</body>
</html>
